################################################################################
# <%= scope.lookupvar('apache::params::mods_availabledir') %>/passenger.conf
# Default configuration of the passenger module for Apache
#                         _                     _
#                        / \   _ __   __ _  ___| |__   ___
#                       / _ \ | '_ \ / _` |/ __| '_ \ / _ \
#                      / ___ \| |_) | (_| | (__| | | |  __/
#                     /_/   \_\ .__/ \__,_|\___|_| |_|\___|
#                             |_|
#  ____                                                             __ _
# |  _ \ __ _ ___ ___  ___ _ __   __ _  ___ _ __    ___ ___  _ __  / _(_) __ _
# | |_) / _` / __/ __|/ _ \ '_ \ / _` |/ _ \ '__|  / __/ _ \| '_ \| |_| |/ _` |
# |  __/ (_| \__ \__ \  __/ | | | (_| |  __/ |    | (_| (_) | | | |  _| | (_| |
# |_|   \__,_|___/___/\___|_| |_|\__, |\___|_|     \___\___/|_| |_|_| |_|\__, |
#                                |___/                                   |___/
################################################################################
#   /!\ DO NOT EDIT THIS FILE -- It has been automatically generated by Puppet.
#  In particular, any further changes will be overwritten at the next puppet
#  invocation
################################################################################
# See http://www.modrails.com/documentation/Users%20guide%20Apache.html#_configuring_phusion_passenger
<IfModule mod_passenger.c>

PassengerRoot <%= passenger_rootdir %>
PassengerRuby <%= scope.lookupvar('passenger::passenger_ruby') %>

# Recommended Passenger Configuration
<% if @lsbdistcodename == 'squeeze' -%>
PassengerUseGlobalQueue  on
<% else -%>
PassengerLoadShellEnvvars off
<% end -%>
PassengerHighPerformance on
# PassengerMaxPoolSize control number of application instances, typically 1.5x
# the number of processor cores. A larger number results in higher memory usage,
# but improved ability to handle concurrent HTTP clients.
# The optimal value depends on your system’s hardware and the server’s average
#    load. You should experiment with different values. But generally speaking,
#    the value should be at least equal to the number of CPUs (or CPU cores) that
#    you have. If your system has 2 GB of RAM, then we recommend a value of
#    15. If your system is a Virtual Private Server (VPS) and has about 256 MB
#    RAM, and is also running other services such as MySQL, then we recommend a
#    value of 2.
PassengerMaxPoolSize <%= scope.lookupvar('processorcount').to_i == 1 ? 2 : scope.lookupvar('processorcount') %>

# Shutdown idle Passenger instances after 30 min.
PassengerPoolIdleTime 1800

# Restart ruby process after handling specific number of request to resolve MRI
# memory leak.
PassengerMaxRequests 4000

# Frequency of filesystem checks (or, in programmers jargon, stat() calls)
# performed each time a request is processed. The default value is 0.
# A value of x means that the above list of filesystem checks will be performed at
#    most once every x seconds. Setting it to a value of 0 means that no
#    throttling will take place, or in other words, that the above list of
#    filesystem checks will be performed on every request.
PassengerStatThrottleRate 120

<% if scope.lookupvar('passenger::passenger_ruby') != '/usr/bin/ruby1.9.1' and scope.lookupvar('passenger::passenger_ruby') != '/usr/bin/ruby1.9.3' and @lsbdistcodename == 'squeeze' %>
# Whether Phusion Passenger should automatically detect whether a virtual host’s
# document root is a Rack application
RackAutoDetect Off

# Whether Phusion Passenger should automatically detect whether a virtual host’s
# document root is a Ruby on Rails application.
RailsAutoDetect On
<% end %>

PassengerDefaultUser <%= scope.lookupvar('passenger::default_user') %>

</IfModule>
